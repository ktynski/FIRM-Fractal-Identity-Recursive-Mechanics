<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ex Nihilo Reality ‚Äî Mathematics that compiles</title>
  <link rel="stylesheet" href="assets/site.css" />
</head>
<body>
  <header class="header">
    <div class="brand"><a href="index.html">Ex Nihilo Reality</a></div>
    <nav class="nav" role="navigation" aria-label="Main navigation">
      <a href="index.html">Home</a>
      <button id="eli25Toggle" class="nav-eli25" aria-label="Toggle between technical and simplified explanations">ELI25</button>
      <a href="article.html">Article</a>
      <a href="for_the_skeptics.html">For the Skeptics</a>
      <a href="roadmap.html">Roadmap</a>
      <a href="#gallery">Gallery</a>
      <a href="FIGURE_GALLERY.md">All Figures</a>
      <a href="https://github.com/ktynski/FIRM-Fractal-Identity-Recursive-Mechanics" target="_blank" rel="noopener">GitHub</a>
    </nav>
    <button class="hamburger-menu" aria-label="Open navigation menu">
      <span></span>
      <span></span>
      <span></span>
    </button>
  </header>

  <main>
    <div id="eli25Modal" class="modal" style="display: none;">
      <div class="modal-content">
        <span class="close-button">&times;</span>
        <h2>Explain It Like I'm 25</h2>
        <p>Imagine you're building with LEGOs, but instead of a manual, you have a single, powerful rule. That rule is "œÜ" (phi, the golden ratio).</p>
        <p><strong>The Core Idea:</strong> This project, FIRM, proposes that the fundamental "rules" of the universe (the physical constants, like the speed of light or the charge of an electron) aren't random. They are the most stable, most perfect structures that can emerge from this single "œÜ" rule. It's like finding the most stable LEGO castle you can build‚Äîit has a specific, mathematically determined shape.</p>
        <p><strong>What We Do:</strong> We don't guess or try to fit the numbers. We start with pure mathematics (our "œÜ" rule) and build, step-by-step, to derive the values of these constants. The fact that our derived values are incredibly close to what scientists measure in the real world suggests our "œÜ" rule is on the right track.</p>
        <p><strong>Why It Matters:</strong> If we're right, it means the universe has a deep, underlying mathematical elegance. We could potentially understand *why* the universe is the way it is, not just *what* it is. It's a shift from describing the universe to truly understanding its blueprint.</p>
      </div>
    </div>
    <section class="hero">
      <div class="hero-content">
        <h1>
          <span data-technical="What if the universe's fundamental constants aren't random?">What if the universe's fundamental constants aren't random?</span>
          <span data-layperson="What if the universe follows a hidden mathematical pattern?">What if the universe follows a hidden mathematical pattern?</span>
        </h1>
        
        <p class="hero-subtitle">
          <span data-technical">We started with pure mathematical axioms‚Äîno physics, no data fitting‚Äîand discovered they naturally generate the exact values we observe in nature. We're sharing our work openly because extraordinary claims require extraordinary scrutiny.</span>
          <span data-layperson">Using only mathematical rules (no physics, no guessing), we found a pattern that predicts the exact numbers that control atoms, light, and gravity. We're sharing everything because we want you to help us prove whether it's right or wrong.</span>
        </p>

        <div class="key-result-hero">
          <div class="key-equation">
            Œ±‚Åª¬π = 137 + œÜ‚Åª‚Å∂ ‚âà 137.05573<br/>
            <em>0.014% accuracy vs. experiment</em>
          </div>
          <p class="result-explanation">
            <span data-technical">Our œÜ-recursive framework predicts the fine structure constant to 0.014% accuracy‚Äîa significant improvement over empirical fitting approaches.</span>
            <span data-layperson">We predicted one of nature's most important numbers with 99.986% accuracy. That's like hitting a penny from 2 miles away.</span>
          </p>
        </div>

        <div class="hero-cta">
          <a class="cta primary" href="article.html">See the Evidence</a>
          <a class="cta secondary" href="for_the_skeptics.html">Challenge Our Claims</a>
        </div>
      </div>
      
      <div class="integrity-pledge">
        <h3>Scientific Integrity First</h3>
        <div class="integrity-grid">
          <div class="integrity-item">
            <span class="integrity-icon">üßÆ</span>
            <h4>Pure Mathematics</h4>
            <p>All derivations from axioms‚Äîno data fitting or parameter tuning</p>
          </div>
          <div class="integrity-item">
            <span class="integrity-icon">üìã</span>
            <h4>Predictions First</h4>
            <p>All predictions registered before testing against experiments</p>
          </div>
          <div class="integrity-item">
            <span class="integrity-icon">üîç</span>
            <h4>Open Everything</h4>
            <p>Complete code, methodology, and audit trails are public</p>
          </div>
          <div class="integrity-item">
            <span class="integrity-icon">‚ùå</span>
            <h4>Seeking Falsification</h4>
            <p>We actively invite attempts to prove our framework wrong</p>
          </div>
        </div>
        <p class="integrity-motto">"We'd rather be wrong with integrity than right through manipulation."</p>
      </div>
      
      <div class="how-it-works">
        <h2>
          <span data-technical>The Mathematical Framework</span>
          <span data-layperson>How We Did It</span>
        </h2>
        
        <div class="method-steps">
          <div class="step">
            <div class="step-number">1</div>
            <div class="step-content">
              <h3>
                <span data-technical>Start with Pure Mathematics</span>
                <span data-layperson>Start with Basic Rules</span>
              </h3>
              <p>
                <span data-technical>We begin with five foundational axioms that establish a mathematical framework‚Äîno physical constants, no experimental data, just pure logical structure.</span>
                <span data-layperson>We started with simple mathematical rules about how systems can change and stay stable. No physics, no measurements‚Äîjust pure logic.</span>
              </p>
            </div>
          </div>
          
          <div class="step">
            <div class="step-number">2</div>
            <div class="step-content">
              <h3>
                <span data-technical>Derive the Grace Operator</span>
                <span data-layperson>Find the Stabilizer</span>
              </h3>
              <p>
                <span data-technical>From these axioms emerges a "Grace Operator"‚Äîa mathematical function that finds the most stable configuration for any system.</span>
                <span data-layperson">Our rules automatically create a "stabilizer" that finds the most balanced, stable way for any system to exist.</span>
              </p>
            </div>
          </div>
          
          <div class="step">
            <div class="step-number">3</div>
            <div class="step-content">
              <h3>
                <span data-technical>œÜ Emerges as Fixed Point</span>
                <span data-layperson>Golden Ratio Appears</span>
              </h3>
              <p>
                <span data-technical>The Grace Operator has a unique fixed point: the golden ratio œÜ. This isn't chosen‚Äîit's the inevitable mathematical consequence.</span>
                <span data-layperson">When we run our stabilizer, it always settles on the golden ratio œÜ = 1.618... This number emerges naturally, we didn't put it in.</span>
              </p>
            </div>
          </div>
          
          <div class="step">
            <div class="step-number">4</div>
            <div class="step-content">
              <h3>
                <span data-technical>Generate Physical Constants</span>
                <span data-layperson>Predict Nature's Numbers</span>
              </h3>
              <p>
                <span data-technical">Recursive applications of œÜ generate precise formulas for fundamental constants. The fine structure constant emerges as Œ±‚Åª¬π = 137 + œÜ‚Åª‚Å∂.</span>
                <span data-layperson">Using œÜ in special patterns, we can calculate the exact numbers that control atoms, light, and the universe itself.</span>
              </p>
            </div>
          </div>
        </div>
        
                <div class="framework-cta">
          <a class="cta secondary" href="article.html#breakthroughs">See the Mathematical Details</a>
        </div>
      </div>
    </section>

    <section class="failure-value">
      <div class="container">
        <h2>What If We're Wrong?</h2>
        <p class="failure-intro">Even if FIRM is completely incorrect, we believe this approach advances science:</p>
        
        <div class="value-grid">
          <div class="value-item">
            <span class="value-icon">üî¨</span>
            <h3>Methodology Matters</h3>
            <p>We've demonstrated how to do rigorous, falsifiable theoretical physics with complete transparency</p>
          </div>
          <div class="value-item">
            <span class="value-icon">üßÆ</span>
            <h3>Mathematical Tools</h3>
            <p>The œÜ-recursive techniques and Grace operator mathematics have value beyond this specific theory</p>
          </div>
          <div class="value-item">
            <span class="value-icon">üìñ</span>
            <h3>Open Science</h3>
            <p>Complete code, derivations, and audit trails show how theoretical work should be shared</p>
          </div>
          <div class="value-item">
            <span class="value-icon">üéØ</span>
            <h3>Elimination Process</h3>
            <p>Ruling out approaches is how science progresses‚Äîevery "no" gets us closer to "yes"</p>
          </div>
        </div>
        
        <div class="failure-conclusion">
          <strong>Science wins either way.</strong> We'd rather fail openly with rigorous methods than succeed through hidden assumptions.
        </div>
    </div>
    </section>

    <section class="implications-stakes">
      <div class="container">
        <h2>What's At Stake</h2>
        <p class="stakes-intro">The implications of this work extend far beyond academic mathematics:</p>
        
        <div class="stakes-comparison">
          <div class="stake-scenario">
            <div class="scenario-header if-right">
              <h3>If FIRM Is Correct</h3>
              <span class="scenario-icon">‚ú®</span>
            </div>
            <ul class="scenario-list">
              <li>The universe has deep, discoverable mathematical elegance</li>
              <li>Physical constants aren't accidents‚Äîthey're inevitable</li>
              <li>We can predict new physics from pure mathematics</li>
              <li>Science education could be fundamentally transformed</li>
              <li>Technology applications we can't yet imagine</li>
            </ul>
          </div>
          
          <div class="stake-scenario">
            <div class="scenario-header if-wrong">
              <h3>If FIRM Is Wrong</h3>
              <span class="scenario-icon">üéØ</span>
            </div>
            <ul class="scenario-list">
              <li>We've advanced mathematical physics methodology</li>
              <li>Open science and falsifiability principles win</li>
              <li>The real answer becomes clearer through our failure</li>
              <li>Future theorists learn from our rigorous approach</li>
              <li>Science progresses through systematic elimination</li>
            </ul>
          </div>
        </div>
        
        <div class="stakes-conclusion">
          <p>Either way, we're contributing to humanity's understanding of reality itself.</p>
          <p><strong>That's worth the risk of being wrong.</strong></p>
        </div>
      </div>
    </section>

    <section class="verification-invitation">
      <div class="container">
        <h2>Independent Verification Invited</h2>
        <p class="verification-intro">We actively seek scrutiny from experts across disciplines:</p>
        
        <div class="verification-grid">
          <div class="verification-call">
            <span class="verification-icon">üßÆ</span>
            <h3>Mathematicians</h3>
            <p>Verify our axiom independence proofs and Grace operator derivations</p>
            <a href="article.html#mathematical" class="verification-link">Review Mathematical Framework ‚Üí</a>
          </div>
          
          <div class="verification-call">
            <span class="verification-icon">‚öõÔ∏è</span>
            <h3>Physicists</h3>
            <p>Test our experimental predictions against precision measurements</p>
            <a href="article.html#constants" class="verification-link">See Predictions ‚Üí</a>
          </div>
          
          <div class="verification-call">
            <span class="verification-icon">üíª</span>
            <h3>Computer Scientists</h3>
            <p>Audit our computational methods and reproducibility claims</p>
            <a href="https://github.com/ktynski/FIRM-Fractal-Identity-Recursive-Mechanics" class="verification-link">Examine Code ‚Üí</a>
          </div>
          
          <div class="verification-call">
            <span class="verification-icon">üéì</span>
            <h3>Science Philosophers</h3>
            <p>Evaluate our epistemological approach and falsifiability claims</p>
            <a href="for_the_skeptics.html" class="verification-link">Challenge Our Claims ‚Üí</a>
          </div>
        </div>
        
        <div class="verification-commitment">
          <h3>Our Commitment</h3>
          <p>We will publicly acknowledge any valid criticisms and update our work accordingly. <strong>Truth matters more than being right.</strong></p>
        </div>
      </div>
    </section>

    <section class="section" id="featured-gallery">
      <h2>Featured Figures</h2>
      <div id="featuredGrid" class="grid"></div>
      </section>

    <section class="article" id="article">
      <div class="articleLayout">
        <aside class="toc">
          <div class="card">
            <h3>Article Contents</h3>
            <ol class="toc-list">
              <li><a href="article.html#executive">Executive Summary</a>
                <ul class="toc-sub-list">
                  <li><a href="article.html#executive">FIRM Framework Overview</a></li>
                  <li><a href="article.html#executive">Key Achievements</a></li>
            </ul>
              </li>
              <li><a href="article.html#breakthroughs">Theoretical Foundation</a>
                <ul class="toc-sub-list">
                  <li><a href="article.html#breakthroughs">Five Foundational Axioms</a></li>
                  <li><a href="article.html#breakthroughs">Grace Operator Theory</a></li>
                  <li><a href="article.html#breakthroughs">œÜ-Recursive Patterns</a></li>
          </ul>
              </li>
              <li><a href="article.html#mathematical">Mathematical Development</a>
                <ul class="toc-sub-list">
                  <li><a href="article.html#mathematical">Differential Operators</a></li>
                  <li><a href="article.html#mathematical">Topological Framework</a></li>
                  <li><a href="article.html#mathematical">Category Theory</a></li>
          </ul>
              </li>
              <li><a href="article.html#constants">Physical Constants Analysis</a>
                <ul class="toc-sub-list">
                  <li><a href="article.html#constants">Fine Structure Constant</a></li>
                  <li><a href="article.html#constants">Mass Ratios</a></li>
                  <li><a href="article.html#constants">Coupling Constants</a></li>
            </ul>
              </li>
              <li><a href="article.html#applications">Applications & Extensions</a>
                <ul class="toc-sub-list">
                  <li><a href="article.html#applications">CMB Predictions</a></li>
                  <li><a href="article.html#applications">Neural Networks</a></li>
                  <li><a href="article.html#applications">Consciousness Models</a></li>
          </ul>
              </li>
              <li><a href="article.html#validation">Validation & Limitations</a>
                <ul class="toc-sub-list">
                  <li><a href="article.html#validation">Statistical Analysis</a></li>
                  <li><a href="article.html#validation">Error Assessment</a></li>
                  <li><a href="article.html#validation">Future Work</a></li>
          </ul>
              </li>
          </ol>
            <div class="toc-footer">
              <a href="article.html" class="cta secondary toc-button">Read Full Article ‚Üí</a>
          </div>
          </div>
        </aside>

        <article>
          <h1>FIRM Theory: Mathematical Framework Overview</h1>
          <h2 id="abstract">Executive Summary</h2>
          <div class="insight">
            <p id="pAbs1">FIRM (Fractal Identity & Recursive Mechanics) proposes a mathematical framework for systematic derivation of fundamental physical constants through œÜ-recursive principles. The approach develops five foundational axioms and a Grace Operator whose fixed points generate recursive scaling patterns governed by the golden ratio <span class="phi">œÜ = (1+‚àö5)/2</span>. Notable precision improvements are achieved, particularly for the fine structure constant, though the theoretical foundation requires continued development and independent validation.</p>
          </div>
          
          <div class="comparison">
            <strong>Key Development:</strong> The framework achieves 0.014% agreement with experimental values for the fine structure constant using the formulation Œ±‚Åª¬π = 137 + œÜ‚Åª‚Å∂, representing significant improvement over previous œÜ-based approaches. However, this precision should be evaluated considering systematic searches through œÜ-formulations and requires independent verification of theoretical foundations.
          </div>
          
          <div class="warning">
            <strong>Current Status:</strong> FIRM theory represents early-stage theoretical development with promising mathematical results that require broader physics community validation before scientific acceptance. The framework provides systematic mathematical tools for continued exploration in mathematical physics.
          </div>

          <div class="fig"><img id="fAbs1" alt="Conceptual overview" /><div class="caption">Overview of FIRM: from axioms through Grace operator to physical reality.</div><div class="actions"><a id="fAbs1Open" class="btn" target="_blank">open</a><a id="fAbs1Peer" class="btn" target="_blank">peer‚Äëreview</a></div></div>
          
          <div class="insight">
            <strong>Continue Reading:</strong> This overview provides a brief introduction to FIRM theory development. For comprehensive theoretical details, mathematical foundations, precision analysis, and validation frameworks, please read the full article.
          </div>
          
          <div class="article-cta">
            <a class="cta" href="article.html">Read the Complete FIRM Theory Article ‚Üí</a>
          </div>

        </article>
      </div>
    </section>

  <script>
    const RAW_BASE = 'https://raw.githubusercontent.com/ktynski/FIRM-Fractal-Identity-Recursive-Mechanics/main/';

    async function headOrFallback(peer, canon){
      try { const r = await fetch(peer, { method: 'HEAD', cache: 'no-store' }); if (r.ok) return peer; } catch(e){}
      return canon;
    }
    function canonical(filename){ return RAW_BASE + 'figures/canonical_outputs/' + filename; }
    function arxiv(filename){ return RAW_BASE + 'arxiv_paper/FIRM_FINAL_SUBMISSION/figures/peer_review/' + filename; }

    function setFig(imgId, openId, peerId, filename){
      const url = canonical(filename);
      const img = document.getElementById(imgId);
      const open = document.getElementById(openId);
      const peer = document.getElementById(peerId);
      if (img) img.src = url;
      if (open) open.href = url;
      if (peer) headOrFallback(arxiv(filename), url).then(href => peer.href = href);
    }

    // Set up the conceptual overview figure
    document.addEventListener('DOMContentLoaded', function() {
      setFig('fAbs1','fAbs1Open','fAbs1Peer','conceptual_overview_diagram.png');
      
      // Gallery functionality
    const grid = document.getElementById('grid');
    const featuredGrid = document.getElementById('featuredGrid');
    const search = document.getElementById('search');
    const sort = document.getElementById('sort');
    const countBadge = document.getElementById('countBadge');
    const chips = document.getElementById('chips');
    const loadMoreBtn = document.getElementById('loadMore');
    const eliBtn = document.getElementById('eli25Toggle');
      const eli25Modal = document.getElementById('eli25Modal');
      const closeButton = document.querySelector('.close-button');

      // Check for saved ELI25 state
      const isELI25Active = localStorage.getItem('eli25Active') === 'true';
      console.log('ELI25 Debug - Initial state:', isELI25Active, 'Button found:', !!eliBtn);
      if (isELI25Active) {
        document.body.classList.add('eli25-active');
        if (eliBtn) eliBtn.textContent = 'Technical';
      }

      if (eliBtn) {
        eliBtn.addEventListener('click', () => {
          console.log('ELI25 Debug - Button clicked');
          // Toggle between modes
          const isCurrentlyActive = document.body.classList.contains('eli25-active');
          console.log('ELI25 Debug - Current state:', isCurrentlyActive);
          
          if (isCurrentlyActive) {
            // Switch to technical mode
            document.body.classList.remove('eli25-active');
            eliBtn.textContent = 'ELI25';
            localStorage.setItem('eli25Active', 'false');
            console.log('ELI25 Debug - Switched to technical mode');
          } else {
            // Switch to layperson mode
            document.body.classList.add('eli25-active');
            eliBtn.textContent = 'Technical';
            localStorage.setItem('eli25Active', 'true');
            console.log('ELI25 Debug - Switched to layperson mode');
          }
        });
      }

      // Keep modal functionality for explanation
      if (closeButton) {
        closeButton.addEventListener('click', () => {
          eli25Modal.style.display = 'none';
        });
      }

      window.addEventListener('click', (event) => {
        if (event.target == eli25Modal) {
          eli25Modal.style.display = 'none';
        }
      });

    let allFigures = [];
    let visible = 0;
    const PAGE = 40;

    const FEATURED = [
        'alpha_inverse_comparison.png'
    ];

    async function loadManifest() {
      try {
        const res = await fetch(RAW_BASE + 'figures/peer_review/figure_manifest.json', { cache: 'no-store' });
        if (res.ok) return res.json();
      } catch (e) {}
      return { figures: [] };
    }

    function inferTags(f) {
      const s = (f.filename || '').toLowerCase();
      const tags = [];
        
        // Physics & Cosmology
        if (s.includes('physics') || s.includes('quark') || s.includes('lepton') || s.includes('boson') || s.includes('particle') || s.includes('standard_model')) tags.push('physics');
        if (s.includes('cosmology') || s.includes('cmb') || s.includes('big_bang') || s.includes('nucleosynthesis') || s.includes('inflation') || s.includes('dark_energy') || s.includes('cosmic') || s.includes('universe')) tags.push('cosmology');
        if (s.includes('gravity') || s.includes('relativity') || s.includes('spacetime') || s.includes('schwarzschild') || s.includes('einstein')) tags.push('gravity');
        if (s.includes('quantum') || s.includes('qft') || s.includes('field_theory') || s.includes('gauge') || s.includes('supersymmetry') || s.includes('string')) tags.push('quantum-field-theory');
        
        // Consciousness & AI
        if (s.includes('consciousness') || s.includes('pnp') || s.includes('neural') || s.includes('ai_acceleration') || s.includes('artificial')) tags.push('consciousness');
        
        // Advanced Mathematical Analysis
        if (s.includes('analysis') || s.includes('pde') || s.includes('elliptic') || s.includes('heat') || s.includes('harmonic') || s.includes('fourier')) tags.push('analysis');
        if (s.includes('functional') || s.includes('operator') || s.includes('spectral') || s.includes('banach') || s.includes('hilbert')) tags.push('functional-analysis');
        if (s.includes('measure') || s.includes('integration') || s.includes('lebesgue') || s.includes('hausdorff') || s.includes('bv_') || s.includes('coarea')) tags.push('measure-theory');
        if (s.includes('calculus') || s.includes('variations') || s.includes('euler') || s.includes('lagrange') || s.includes('hamilton')) tags.push('calculus-variations');
        if (s.includes('distribution') || s.includes('sobolev') || s.includes('schwartz') || s.includes('tempered')) tags.push('distribution-theory');
        
        // Pure Mathematics
        if (s.includes('category') || s.includes('topos') || s.includes('morphism') || s.includes('functor') || s.includes('eilenberg')) tags.push('category-theory');
        if (s.includes('geometry') || s.includes('riemann') || s.includes('manifold') || s.includes('curvature') || s.includes('differential')) tags.push('geometry');
        if (s.includes('topology') || s.includes('homology') || s.includes('cohomology') || s.includes('spectral_sequence') || s.includes('homotopy')) tags.push('topology');
        if (s.includes('algebra') || s.includes('group') || s.includes('ring') || s.includes('field') || s.includes('galois') || s.includes('automorphic')) tags.push('algebra');
        if (s.includes('lie') || s.includes('root_systems') || s.includes('representation') || s.includes('symmetric')) tags.push('lie-theory');
        if (s.includes('number_theory') || s.includes('prime') || s.includes('zeta') || s.includes('diophantine') || s.includes('arithmetic')) tags.push('number-theory');
        if (s.includes('probability') || s.includes('stochastic') || s.includes('random') || s.includes('clt') || s.includes('lln') || s.includes('markov')) tags.push('probability');
        if (s.includes('logic') || s.includes('proof') || s.includes('theorem') || s.includes('axiom') || s.includes('formal') || s.includes('set_theory') || s.includes('descriptive')) tags.push('logic');
        if (s.includes('k_theory') || s.includes('homological') || s.includes('derived') || s.includes('cohomological')) tags.push('k-theory');
        
        // FIRM Theory Specific
        if (s.includes('phi') || s.includes('golden') || s.includes('grace') || s.includes('firm') || s.includes('recursive')) tags.push('firm-theory');
        if (s.includes('alpha') || s.includes('fine_structure') || s.includes('constant') || s.includes('derivation') || s.includes('comparison') || s.includes('precision_measurements')) tags.push('constants');
        
        // Applied & Computational
        if (s.includes('optimization') || s.includes('control') || s.includes('game_theory') || s.includes('economics')) tags.push('applied-math');
        if (s.includes('computational') || s.includes('algorithm') || s.includes('complexity') || s.includes('machine_learning') || s.includes('computing')) tags.push('computational');
        if (s.includes('energy') || s.includes('technology') || s.includes('applications') || s.includes('engineering')) tags.push('applications');
        
        // Geometric & Topological Specialties
        if (s.includes('tiling') || s.includes('aperiodic') || s.includes('penrose') || s.includes('crystal')) tags.push('tilings');
        if (s.includes('bridge') || s.includes('dimensional') || s.includes('mapping') || s.includes('correspondence')) tags.push('mathematical-bridges');
        if (s.includes('amenability') || s.includes('folner') || s.includes('group_theory') || s.includes('dynamics')) tags.push('group-dynamics');
        
        // Specific Mathematical Objects & Techniques
        if (s.includes('epsilon') || s.includes('component') || s.includes('scan') || s.includes('parameter')) tags.push('parameter-studies');
        if (s.includes('timeline') || s.includes('historical') || s.includes('evolution') || s.includes('development')) tags.push('mathematical-history');
        if (s.includes('overview') || s.includes('conceptual') || s.includes('diagram') || s.includes('framework')) tags.push('conceptual');
        if (s.includes('lagrangian') || s.includes('hamiltonian') || s.includes('mechanics') || s.includes('dynamics')) tags.push('mechanics');
        
        // Catch remaining mathematical terms
        if (tags.length === 0) {
          if (s.includes('theorem') || s.includes('lemma') || s.includes('conjecture') || s.includes('nash') || s.includes('moser') || s.includes('giorgi')) tags.push('theorems');
          else if (s.includes('function') || s.includes('transform') || s.includes('calderon') || s.includes('zygmund')) tags.push('functions');
          else if (s.includes('space') || s.includes('metric') || s.includes('norm') || s.includes('carleson')) tags.push('spaces');
          else if (s.includes('structure') || s.includes('formation') || s.includes('matter') || s.includes('dark')) tags.push('structures');
          else tags.push('miscellaneous'); // Very few should reach here now
        }
        
      return tags;
    }

    const activeTags = new Set();
    let tagCounts = {};

    function computeTagCounts() {
      tagCounts = {};
      for (const f of allFigures) {
        for (const t of inferTags(f)) {
          tagCounts[t] = (tagCounts[t] || 0) + 1;
        }
      }
    }

    function renderChips() {
      computeTagCounts();
        if (!chips) return;
      chips.innerHTML = '';
      const tagsSorted = Object.keys(tagCounts).sort((a,b)=> (tagCounts[b]-tagCounts[a]));
      for (const t of tagsSorted) {
        const count = tagCounts[t];
        if (!count) continue;
        const el = document.createElement('div');
        el.className = 'chip' + (activeTags.has(t) ? ' active' : '');
        el.textContent = `${t} (${count})`;
        el.onclick = () => { if (activeTags.has(t)) activeTags.delete(t); else activeTags.add(t); resetAndRender(); };
        chips.appendChild(el);
      }
    }

    function filteredSorted() {
      let q = (search.value || '').toLowerCase().trim();
      let arr = allFigures;
      if (q) {
        arr = allFigures.filter(f => f.filename.toLowerCase().includes(q));
      }
      
      if (activeTags.size) {
        arr = arr.filter(f => {
          const ts = inferTags(f);
          return ts.some(tag => activeTags.has(tag));
        });
      }
      const mode = sort.value;
      if (mode === 'width') arr.sort((a,b)=> (b.width||0)-(a.width||0));
      else if (mode === 'height') arr.sort((a,b)=> (b.height||0)-(a.height||0));
      else arr.sort((a,b)=> (a.filename||'').localeCompare(b.filename||''));
      return arr;
    }

    function resetAndRender() {
      visible = 0;
        if(grid) grid.innerHTML = '';
      renderChips();
      const arr = filteredSorted();
        if(countBadge) countBadge.textContent = arr.length;
      appendMore(arr);
    }

    function appendMore(arr) {
      const next = arr.slice(visible, visible + PAGE);
      visible += next.length;
        if(grid) {
      for (const f of next) grid.appendChild(tileFor(f));
        }
        if(loadMoreBtn) {
      loadMoreBtn.style.display = (visible < arr.length) ? 'block' : 'none';
      loadMoreBtn.onclick = () => appendMore(arr);
        }
    }

    function tileFor(f) {
      const tile = document.createElement('div');
      tile.className = 'tile';
        const img = document.createElement('img'); 
        img.loading = 'lazy'; 
        img.decoding = 'async'; 
        img.src = canonical(f.filename); 
        img.alt = f.filename;
        
        const meta = document.createElement('div'); 
        meta.className = 'meta';
        
        const name = document.createElement('div'); 
        name.className = 'name'; 
        name.textContent = f.filename;

          const tagsContainer = document.createElement('div');
          tagsContainer.className = 'tags';
          const tags = inferTags(f);
          for (const t of tags) {
            const tagEl = document.createElement('span');
            tagEl.className = 'tag';
            tagEl.textContent = t;
            tagsContainer.appendChild(tagEl);
          }
        
        const actions = document.createElement('div'); 
        actions.className = 'actions';
        
        const openBtn = document.createElement('a'); 
        openBtn.className = 'btn'; 
        openBtn.href = canonical(f.filename); 
        openBtn.target = '_blank'; 
        openBtn.textContent = 'open';
        
        actions.appendChild(openBtn);
        meta.appendChild(name);
          meta.appendChild(tagsContainer);
        meta.appendChild(actions);
        tile.appendChild(img);
        tile.appendChild(meta);
        
        return tile;
      }

        // Populate featured grid
        if (featuredGrid) {
          for (const f of FEATURED) {
            featuredGrid.appendChild(tileFor({ filename: f }));
          }
      }

      // Load the gallery data
      loadManifest().then(data => {
      allFigures = data.figures || [];
      resetAndRender();
        if (search) search.addEventListener('input', resetAndRender);
        if (sort) sort.addEventListener('change', resetAndRender);
      });

      const hamburgerMenu = document.querySelector('.hamburger-menu');
      const nav = document.querySelector('.nav');
        if (hamburgerMenu && nav) {
      hamburgerMenu.addEventListener('click', () => {
        nav.classList.toggle('active');
      });
          
          // Close menu when clicking outside
          document.addEventListener('click', (event) => {
            if (!hamburgerMenu.contains(event.target) && !nav.contains(event.target)) {
              nav.classList.remove('active');
            }
          });
        }

        // Smooth scrolling for anchor links
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
          anchor.addEventListener('click', function (e) {
            e.preventDefault();
            const target = document.querySelector(this.getAttribute('href'));
            if (target) {
              target.scrollIntoView({
                behavior: 'smooth',
                block: 'start'
              });
            }
          });
        });

        const backToTopButton = document.getElementById('backToTop');
        window.onscroll = function() {
          if (document.body.scrollTop > 200 || document.documentElement.scrollTop > 200) {
            if (backToTopButton) backToTopButton.style.display = 'block';
          } else {
            if (backToTopButton) backToTopButton.style.display = 'none';
          }
        };
        if (backToTopButton) {
          backToTopButton.onclick = function() {
            document.body.scrollTop = 0;
            document.documentElement.scrollTop = 0;
          };
        }
    });
  </script>

    <!-- Gallery Section -->
    <section class="section" id="gallery">
      <h2>Figure Gallery</h2>
      <div class="controls">
        <div class="toolbar">
          <input class="search" id="search" placeholder="Search figure names‚Ä¶" />
          <select class="select" id="sort">
            <option value="name">Sort: Name</option>
            <option value="width">Sort: Width</option>
            <option value="height">Sort: Height</option>
          </select>
          <span class="badge" id="countBadge">Loading...</span>
        </div>
      </div>
      <div class="filterchips" id="chips"></div>
      <div id="grid" class="grid"></div>
      <button class="btn loadmore" id="loadMore">Load More</button>
    </section>
    
    <section class="section">
      <div class="card">
        <h3>Reproduce it yourself</h3>
        <p class="subtle">Everything here is generated from code. Clone the repo and run the peer‚Äëreview sync to rebuild the canonical set and arXiv copies:</p>
        <pre class="subtle code-block">python figures/peer_review/sync_and_verify.py --generate-math
python figures/peer_review/sync_and_verify.py --prepare-submission</pre>
        <p class="subtle">Outputs: <code>figures/canonical_outputs/</code> (single source of truth) and <code>arxiv_paper/FIRM_FINAL_SUBMISSION/figures/peer_review/</code> (submission‚Äëready).</p>
      </div>
    </section>
    
    <section class="footer">
      <div>¬© Ex Nihilo Reality ‚Äî All figures generated from code; see repository for provenance.</div>
    </section>
  </main>
  <button id="backToTop" class="back-to-top" title="Go to top">‚Üë</button>
</body>
</html>
